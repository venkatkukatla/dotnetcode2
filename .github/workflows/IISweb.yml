name: Deploy to IIS via Web Deploy

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: self-hosted

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v1

      - name: Allow PowerShell Scripts
        run: Set-ExecutionPolicy RemoteSigned -Scope Process -Force
        shell: powershell

      - name: Restore Packages
        run: nuget restore dotnet.sln

      - name: Build Solution
        run: msbuild.exe dotnet.sln /p:Configuration=Release

      - name: Create Deploy Folder
        run: mkdir -Force D:\a\dotnetcode2\deploy

      # - name: Publish to Folder
      #   run: |
      #     msbuild.exe dotnet.sln `
      #       /p:DeployOnBuild=true `
      #       /p:WebPublishMethod=Package `
      #       /p:PackageLocation="D:\a\dotnetcode2\deploy\dotnet.zip" `
      #       /p:Configuration=Release
      
      - name: Publish Project to Folder (without packaging)
        run: |
          msbuild.exe dotnet.sln `
            /p:DeployOnBuild=true `
            /p:WebPublishMethod=FileSystem `
            /p:PublishDir="D:\a\dotnetcode2\output\" `
            /p:Configuration=Release

      - name: Copy Files to IIS Site Folder
        run: |
          robocopy "D:\a\dotnetcode2\output" "C:\hello" /MIR


      # - name: List Published Files (Debug)
      #   run: dir D:\a\dotnetcode2\deploy

      # - name: Upload Artifact (Optional)
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: dotnet-deploy-package
      #     path: D:/a/dotnetcode2/deploy/dotnet.zip




